# ============================================
# Neanelu Shopify - Environment Variables Template
# ============================================
# INSTRUCȚIUNI:
# 1. Copiază acest fișier în .env (care NU se comite)
# 2. Completează valorile reale
# 3. Pentru staging/prod, secretele vin din OpenBAO (secret manager)
#
# ROTAȚIE CHEI: Trimestrială pentru token-uri externe (Shopify, BullMQ, OpenAI)
# și chei AES. Documentație completă în Docs/DevOps_Plan_Implementare_Shopify_Enterprise.md

# ============================================
# DATABASE (PostgreSQL 18.1)
# ============================================
# Conexiune runtime (rol app_runtime cu permisiuni limitate)
DATABASE_URL=postgresql://app_runtime:password@localhost:65010/neanelu_shopify

# Conexiune migrații (rol app_migrator cu permisiuni DDL)
DATABASE_URL_MIGRATE=postgresql://app_migrator:password@localhost:65010/neanelu_shopify

# Pool sizing (vezi Plan_de_implementare F2.1.1 pentru recomandări)
# Dev: 10, Staging/Prod: 5 (cu 10 worker containers = 50+ conexiuni totale)
DB_POOL_SIZE=10

# ============================================
# REDIS 8.4 (Cache, Cozi, Vector Search)
# ============================================
REDIS_URL=redis://localhost:65011

# ============================================
# SHOPIFY API
# ============================================
SHOPIFY_API_KEY=your_api_key_here
SHOPIFY_API_SECRET=your_api_secret_here

# Admin API version (default: 2025-10). Fallback handling lives in @app/config.
SHOPIFY_API_VERSION=2025-10

# Scopes necesare pentru aplicație (lista completă)
SCOPES=read_products,write_products,read_orders,read_inventory,write_inventory,read_fulfillments,read_price_rules,read_discounts

# Pentru embedded app (opțional, dacă nu ești embedded lasă gol)
SHOPIFY_APP_URL=https://your-app-domain.com

# ============================================
# BULLMQ PRO (Registry privat + Runtime License)
# ============================================
# Token pentru npm registry privat Taskforce.sh (folosit de pnpm install)
NPM_TASKFORCESH_TOKEN=your_bullmq_pro_npm_token

# Token de licență runtime BullMQ Pro (folosit în cod)
BULLMQ_PRO_TOKEN=your_bullmq_pro_license_token

# ============================================
# OPENAI / AI ENGINE
# ============================================
OPENAI_API_KEY=your_openai_api_key

# Model pentru embeddings (default: text-embedding-3-small)
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# ============================================
# SECURITY & ENCRYPTION
# ============================================
# Cheie AES-256-GCM pentru criptare token-uri Shopify în DB
# Generare: openssl rand -hex 32
ENCRYPTION_KEY_256=your_64_char_hex_key_here_must_be_exactly_64_chars

# Suport rotație chei (backward compatibility)
# La rotație, adaugă ENCRYPTION_KEY_V2 și schimbă VERSION la 2
ENCRYPTION_KEY_VERSION=1
# ENCRYPTION_KEY_V1=first_64_char_hex_key
# ENCRYPTION_KEY_V2=new_64_char_hex_key_after_rotation

# ============================================
# APPLICATION
# ============================================
# URL-ul public al aplicației (pentru OAuth callback, webhooks)
APP_HOST=https://localhost:65000

# Mediul curent: development | staging | production
NODE_ENV=development

# Nivel de logging: debug | info | warn | error
LOG_LEVEL=debug

# Port pentru server (default: 3000)
PORT=65000

# ============================================
# OBSERVABILITY (OpenTelemetry)
# ============================================
# Endpoint OTLP pentru export spans/metrics (Jaeger în dev, Grafana Tempo în prod)
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:65022

# Numele serviciului în traces
OTEL_SERVICE_NAME=neanelu-shopify

# Sampling ratio (1.0 = toate, 0.1 = 10% în prod pentru cost)
# OTEL_SAMPLING_RATIO este documentat mai jos în secțiunea "OBSERVABILITY EXTENDED".

# ============================================
# DOCKER COMPOSE (pentru servicii locale)
# ============================================
# Aceste variabile sunt folosite de docker-compose.yml
# Vezi și .env.compose.example pentru configurații Docker-only
POSTGRES_USER=shopify
POSTGRES_PASSWORD=shopify_dev_password
POSTGRES_DB=neanelu_shopify_dev

# ============================================
# OBSERVABILITY EXTENDED (CONFORM Problems & Fixes.md + F3.4.5)
# ============================================
# OpenTelemetry configuration per environment.
# Vezi Docs/Metrics_Reference.md pentru lista completă de metrici.
#
# === Development (current) ===
# OTEL_SAMPLING_RATIO=1.0          # 100% traces
# LOG_LEVEL=debug
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:65022
# OBS_DEBUG=1                       # verbose OTel diagnostics
#
# === Staging ===
# OTEL_SAMPLING_RATIO=0.5          # 50% traces
# LOG_LEVEL=info
# OBS_DEBUG=0
#
# === Production ===
# OTEL_SAMPLING_RATIO=0.1          # 10% traces
# LOG_LEVEL=warn
# OTEL_ERROR_SAMPLING=1.0          # 100% pentru erori
# OBS_DEBUG=0
#
# === CI (OTel disabled) ===
# OTEL_EXPORTER_OTLP_ENDPOINT=     # gol = tracing dezactivat
# OTEL_SAMPLING_RATIO=0

# Current Environment Settings:
OTEL_SAMPLING_RATIO=1.0

# Error sampling (always 100% pentru erori indiferent de mediu)
OTEL_ERROR_SAMPLING=1.0

# Diagnostic mode (1 = verbose OTel logs, 0 = silent)
OBS_DEBUG=0

# ============================================
# LOKI + GRAFANA STACK
# ============================================
LOKI_VERSION=3.6.3
GRAFANA_VERSION=12.3.1
OTEL_COLLECTOR_VERSION=0.142.0

# Grafana credentials (SCHIMBĂ ÎN PRODUCȚIE!)
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=changeme_in_production

# Ports (conform range 65xxx)
LOKI_PORT=65023
GRAFANA_PORT=65024

# Loki retention (744h = 31 zile)
LOKI_RETENTION_PERIOD=744h




# ============================================
# DATABASE BOOTSTRAP (F2.1.2.2)
# ============================================
# Variabile pentru scripts/db-bootstrap.sh
# ⚠️ TOATE sunt OBLIGATORII - scriptul eșuează fără ele!
# În producție, toate vin din secret manager (OpenBAO/Vault)

# Numele rolului pentru migrații (DDL operations)
MIGRATOR_ROLE_NAME=<numele_rolului_migrator>

# Numele rolului pentru runtime (DML operations)
RUNTIME_ROLE_NAME=<numele_rolului_runtime>

# Parola pentru rolul migrator
# ⚠️ SCHIMBĂ ACEASTA!
MIGRATION_DB_PASSWORD=<parola_din_secret_manager>

# Parola pentru rolul runtime
# ⚠️ SCHIMBĂ ACEASTA!
RUNTIME_DB_PASSWORD=<parola_din_secret_manager>

# Parola superuser PostgreSQL (pentru bootstrap)
# ⚠️ SCHIMBĂ ACEASTA! În Docker dev, trebuie să coincidă cu POSTGRES_PASSWORD
POSTGRES_SUPERUSER_PASSWORD=<parola_din_secret_manager>
