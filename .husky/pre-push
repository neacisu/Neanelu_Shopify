#!/bin/sh
# ============================================
# PRE-PUSH HOOK (Husky 9+ format)
# ============================================

# Get the directory where the repo root is (where .env should be)
REPO_ROOT="$(git rev-parse --show-toplevel)"

# Source environment variables from .env if it exists
if [ -f "$REPO_ROOT/.env" ]; then
  set -a
  # Best-effort load. Some .env files may contain values not compatible with POSIX sh.
  . "$REPO_ROOT/.env" >/dev/null 2>&1 || true
  set +a
fi

echo 'ğŸ§ª Running tests before push...'
pnpm test || {
  echo 'âŒ Tests failed! Push aborted.'
  echo 'Run "pnpm test" to see failures.'
  exit 1
}

echo 'âœ… All tests passed! Pushing...'
