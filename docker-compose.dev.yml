# ============================================
# Neanelu Shopify - Docker Compose Development Override
# ============================================
# Override-uri specifice pentru dezvoltare locală
# Expune porturi, activează debug, etc.
#
# Utilizare: docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d
# Sau simplu: pnpm db:up

services:
  # ============================================
  # Backend API (Fastify) - Development Override
  # ============================================
  backend-worker:
    ports:
      - '65000:65000'

  # ============================================
  # Frontend Web Admin - Placeholder (future)
  # ============================================
  web-admin:
    ports:
      - '65001:65001'

  # ============================================
  # Bull Board - Placeholder (future)
  # ============================================
  bull-board:
    ports:
      - '65032:65032'
  # ============================================
  # PostgreSQL - Development Override
  # ============================================
  db:
    ports:
      - '65010:5432'
    environment:
      # Log toate statement-urile în dev pentru debugging
      POSTGRES_HOST_AUTH_METHOD: scram-sha-256
    # Override command pentru logare extinsă în dev
    command: >
      postgres
      -c shared_buffers=256MB
      -c work_mem=64MB
      -c maintenance_work_mem=128MB
      -c effective_cache_size=512MB
      -c max_connections=200
      -c log_statement=all
      -c log_min_duration_statement=100
      -c log_connections=on
      -c log_disconnections=on

  # ============================================
  # Redis - Development Override
  # ============================================
  redis:
    ports:
      - '65011:6379'

  # ============================================
  # Jaeger - Development Override
  # ============================================
  jaeger:
    ports:
      # UI Web Jaeger
      - '65020:16686'
      # OTLP gRPC
      - '65021:4317'

  # ============================================
  # OpenTelemetry Collector - Development Override
  # ============================================
  otel-collector:
    ports:
      # OTLP HTTP (App -> Collector)
      - '65022:4318'

  # ============================================
  # Loki - Development Override
  # ============================================
  loki:
    ports:
      - '65023:3100'

  # ============================================
  # Grafana - Development Override
  # ============================================
  grafana:
    ports:
      - '65024:3000'

  # ============================================
  # Prometheus - Development Override
  # ============================================
  prometheus:
    ports:
      - '65025:9090'

  # ============================================
  # pgAdmin 4 - GUI pentru PostgreSQL (opțional, doar dev)
  # ============================================
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: neanelu_pgadmin
    restart: unless-stopped
    ports:
      - '65030:80'
    environment:
      PGADMIN_DEFAULT_EMAIL: ${PGADMIN_EMAIL}
      PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_PASSWORD}
      PGADMIN_CONFIG_SERVER_MODE: 'False'
    volumes:
      - pgadmin_data:/var/lib/pgadmin
    networks:
      - neanelu_network
    depends_on:
      db:
        condition: service_healthy

  # ============================================
  # Redis Commander - GUI pentru Redis (opțional, doar dev)
  # ============================================
  redis-commander:
    image: rediscommander/redis-commander:latest
    container_name: neanelu_redis_commander
    restart: unless-stopped
    ports:
      - '65031:8081'
    environment:
      REDIS_HOSTS: local:redis:6379
    networks:
      - neanelu_network
    depends_on:
      - redis

# ============================================
# VOLUMES (doar dev - pentru GUI tools)
# ============================================
volumes:
  pgadmin_data:
    name: neanelu_pgadmin_data
