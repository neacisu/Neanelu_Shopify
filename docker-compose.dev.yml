# ============================================
# Neanelu Shopify - Docker Compose Development Override
# ============================================
# Override-uri specifice pentru dezvoltare locală
# Expune porturi, activează debug, etc.
#
# Utilizare: docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d
# Sau simplu: pnpm db:up

services:
  # ============================================
  # PostgreSQL - Development Override
  # ============================================
  db:
    ports:
      - '65010:5432'
    environment:
      # Log toate statement-urile în dev pentru debugging
      POSTGRES_HOST_AUTH_METHOD: scram-sha-256
    # Override command pentru logare extinsă în dev
    command: >
      postgres
      -c shared_buffers=256MB
      -c work_mem=64MB
      -c maintenance_work_mem=128MB
      -c effective_cache_size=512MB
      -c max_connections=200
      -c log_statement=all
      -c log_min_duration_statement=100
      -c log_connections=on
      -c log_disconnections=on

  # ============================================
  # Redis - Development Override
  # ============================================
  redis:
    ports:
      - '65011:6379'

  # ============================================
  # Jaeger - Development Override
  # ============================================
  jaeger:
    ports:
      # UI Web Jaeger
      - '65020:16686'
      # OTLP gRPC
      - '65021:4317'
      # OTLP HTTP
      - '65022:4318'
      # Zipkin (pentru compatibilitate)
      - '65023:9411'

  # ============================================
  # pgAdmin 4 - GUI pentru PostgreSQL (opțional, doar dev)
  # ============================================
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: neanelu_pgadmin
    restart: unless-stopped
    ports:
      - '65030:80'
    environment:
      PGADMIN_DEFAULT_EMAIL: ${PGADMIN_EMAIL}
      PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_PASSWORD}
      PGADMIN_CONFIG_SERVER_MODE: 'False'
    volumes:
      - pgadmin_data:/var/lib/pgadmin
    networks:
      - neanelu_network
    depends_on:
      db:
        condition: service_healthy

  # ============================================
  # RedisInsight - GUI pentru Redis (opțional, doar dev)
  # ============================================
  redisinsight:
    image: redislabs/redisinsight:latest
    container_name: neanelu_redisinsight
    restart: unless-stopped
    ports:
      - '65031:5540'
    volumes:
      - redisinsight_data:/data
    networks:
      - neanelu_network
    depends_on:
      - redis

# ============================================
# VOLUMES (doar dev - pentru GUI tools)
# ============================================
volumes:
  pgadmin_data:
    name: neanelu_pgadmin_data
  redisinsight_data:
    name: neanelu_redisinsight_data
